import{b as fe,j as f,y as de,a as me,a1 as ge,S as Y,a4 as Z,a5 as Se}from"./index-dZo7T_Yr.js";import{a as t,i as _e,ac as P,ad as ye,v as ve,S as Ee,d as te}from"./preload-OoidQG6T.js";const pe="100%",Ne="1.5",he="cover",O={defaultWidth:pe,defaultAspectRatio:Ne,defaultObjectFit:he};function Re(e,n,s,i){const[c,r]=t.useState({src:void 0,loading:!!e&&!n});return t.useEffect(()=>{if(!e||!_e()){r({src:void 0,loading:!1});return}if(n){const u=P(e,s);r({src:u,loading:!1});return}const l=ye(e);if(l){r({src:l,loading:!1});return}let d=!1;return r({src:void 0,loading:!0}),ve(e,i).then(u=>{d||r({src:u,loading:!1})}).catch(()=>{if(!d){const u=P(e,s);r({src:u,loading:!1})}}),()=>{d=!0}},[e,n,s,i]),c}const Ae=Ee.loaderTimeout;function Fe(){const{withTimeout:e}=fe(),[n,s]=t.useState(void 0),[i,c]=t.useState(!1),[r,l]=t.useState(!1),d=t.useCallback(_=>{e(()=>{s(_)},_?0:Ae)},[e]);t.useEffect(()=>{n===!1?c(!0):n===!0&&l(!0)},[n]);const u=t.useCallback(()=>{s(void 0),c(!1),l(!1)},[]);return{ready:n,shouldAnimate:i,fadeIn:r,setReady:d,reset:u}}const Te=t.forwardRef(({isOpen:e,onCancel:n,focusOnOpen:s=!0,maxWidth:i,padding:c,border:r,borderRadius:l,backdropColor:d,backdropBlur:u,portalTarget:_,className:b,style:y,children:k,...w},A)=>{const m=t.useRef(null);t.useImperativeHandle(A,()=>m.current,[]);const[F,T]=t.useState(!1);t.useEffect(()=>{T(!0)},[]);const I=t.useMemo(()=>({...{...i!=null?{"--dialog-max-width":i}:{},...c!=null?{"--dialog-padding":c}:{},...r!=null?{"--dialog-border":r}:{},...l!=null?{"--dialog-border-radius":l}:{},...d!=null?{"--dialog-backdrop-color":d}:{},...u!=null?{"--dialog-backdrop-blur":u}:{}},...y??{}}),[i,c,r,l,d,u,y]);t.useEffect(()=>{const o=m.current;if(o&&e!==void 0)try{e?(o.open||o.showModal(),s&&o.focus()):o.open&&o.close()}catch{}},[e,s]);const D=o=>{if(o.preventDefault(),n){n();return}e===void 0&&m.current?.close()},p=f.jsx("dialog",{ref:m,className:te("dialog",b),style:I,onCancel:D,...w,children:k});if(!F)return null;const j=_??(typeof document<"u"?document.body:null);return j?de.createPortal(p,j):null}),je=(e,n)=>{const s=n-1,i=n-2;return n<=1?"100%":e===s?"70%":e===i?"85%":"100%"},xe=({rows:e=0})=>e<=0?f.jsx("div",{className:"skeleton skeleton__block","aria-busy":"true"}):f.jsx("div",{className:"skeleton skeleton__rows","aria-busy":"true",children:Array.from({length:e}).map((n,s)=>f.jsx("div",{className:"skeleton__row",style:{width:je(s,e)}},s))}),be=O.defaultWidth,ke=O.defaultAspectRatio,L=O.defaultObjectFit,U=e=>e!=null&&e!=="",ee=e=>e==="auto"?void 0:e,we=e=>e==="auto"||e===""?void 0:e,Ie=e=>{if(e==null||e===""||e==="auto")return;if(typeof e=="number")return Number.isFinite(e)&&e>0?e:void 0;const n=String(e).trim();if(!n)return;if(n.includes("/")){const[i,c]=n.split("/"),r=Number.parseFloat(i.trim()),l=Number.parseFloat(c.trim());return Number.isFinite(r)&&Number.isFinite(l)&&r>0&&l>0?r/l:void 0}const s=Number.parseFloat(n);if(Number.isFinite(s)&&s>0)return s};function De({src:e,disableBlob:n=!1,disableLazyLoading:s=!1,disableAssetHash:i=!1,objectFit:c,aspectRatio:r,clickOpenMode:l="none",style:d,className:u,onLoad:_,onError:b,fetchPriority:y="auto",loading:k="eager",decoding:w="async",width:A,height:m,onClick:F,alt:T,...I},D){const{screenType:p}=me(),j=ge(),{src:o}=Re(e,n,i,y),{ready:v,setReady:W,reset:N}=Fe(),[g,S]=t.useState(!1),[h,R]=t.useState("none"),{boxStyle:se,imgStyle:ne,useSizer:ae}=t.useMemo(()=>{const a=ee(A),H=ee(m),q=we(r),J=U(a),C=U(H),$=U(q),K=!$&&!C,ie=J&&C?void 0:$?q:K?ke:void 0,ce=J?a:be,Q=C?H:void 0,ue=K&&c==null?L:c??L,V=Ie(ie),X=Q==null&&V!=null;return{boxStyle:{width:ce,height:Q,...X?{"--lazy-image-ar":V}:{}},imgStyle:{objectFit:ue},useSizer:X}},[r,c,A,m]),z=t.useMemo(()=>!(p===Y.Mobile||p===Y.Error),[p]),x=t.useCallback(a=>{W(a)},[W]);t.useEffect(()=>()=>{S(!1)},[]),t.useEffect(()=>{!o&&g&&S(!1)},[o,g]),t.useEffect(()=>{v===!1&&!s&&g&&S(!1)},[v,s,g]),t.useEffect(()=>{s||(e?(N(),R("none"),x(!1)):(N(),R("none")))},[e,N,x,s]),t.useEffect(()=>{if(!s){if(v===!1)R("fade");else if(v===!0&&h==="fade"){const a=requestAnimationFrame(()=>{R("fade-in")});return()=>{cancelAnimationFrame(a)}}}},[v,h,s]),t.useEffect(()=>{s&&(N(),R("none"))},[s,N]),t.useEffect(()=>{g&&!z&&S(!1)},[z,g]),t.useEffect(()=>{u&&Z()},[u]),t.useEffect(()=>{d&&Z()},[d]);const E=v===!1&&!s,M=l==="tab"&&!!o&&!E,B=l==="dialog"&&!!o&&!E&&z,G=(!!F||M||B)&&!E,re=s?{}:{"lazy-image__fade":h==="fade"||h==="fade-in","lazy-image__fade-in":h==="fade-in"},oe=E?{}:{"lazy-image__clickable":G},le=ae?{"lazy-image__sizer":!0}:{};return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:te("lazy-image",re,oe,le),style:se,children:[E&&f.jsx(Se,{children:f.jsx("div",{className:"lazy-image__skeleton",children:f.jsx(xe,{})})}),o&&f.jsx("img",{...I,ref:D,src:o,alt:T,className:"lazy-image__image",draggable:!1,style:ne,onClick:a=>{if(E){a.preventDefault();return}if(F?.(a),!a.defaultPrevented){if(M){j(o);return}B&&S(!0)}},onLoad:a=>{x(!0),_?.(a)},onError:a=>{x(!0),b?.(a)},loading:k,decoding:w,...y?{fetchpriority:y}:{}})]}),G&&f.jsx(Te,{isOpen:g,className:"lazy-image__dialog",onCancel:()=>S(!1),onClick:a=>{a.target===a.currentTarget&&S(!1)},children:f.jsx("div",{className:"lazy-image__dialog-content",children:f.jsx("img",{src:o,alt:T,className:"lazy-image__dialog-image",draggable:!1,onClick:a=>{a.stopPropagation()}})})})]})}const Ue=t.forwardRef(De);export{Ue as L,xe as S,Fe as u};
