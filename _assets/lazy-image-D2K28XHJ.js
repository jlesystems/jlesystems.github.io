import{b as ne,k as oe,j as c,z as le,a2 as re,a3 as J,a5 as ce}from"./index-P3iUZ1wU.js";import{a as t,i as fe,a8 as $,a9 as ue,v as ie,d as V}from"./preload-6WZxzW4-.js";const de="100%",me="1.5",ge="cover",O={defaultWidth:de,defaultAspectRatio:me,defaultObjectFit:ge};function ve(e,n,s,f){const[u,l]=t.useState({src:void 0,loading:!!e&&!n});return t.useEffect(()=>{if(!e||!fe()){l({src:void 0,loading:!1});return}if(n){const r=$(e,s);l({src:r,loading:!1});return}const i=ue(e);if(i){l({src:i,loading:!1});return}let d=!1;return l({src:void 0,loading:!0}),ie(e,f).then(r=>{d||l({src:r,loading:!1})}).catch(()=>{if(!d){const r=$(e,s);l({src:r,loading:!1})}}),()=>{d=!0}},[e,n,s,f]),u}const _e=oe.loaderTimeout;function Se(){const{withTimeout:e}=ne(),[n,s]=t.useState(void 0),[f,u]=t.useState(!1),[l,i]=t.useState(!1),d=t.useCallback(v=>{e(()=>{s(v)},v?0:_e)},[e]);t.useEffect(()=>{n===!1?u(!0):n===!0&&i(!0)},[n]);const r=t.useCallback(()=>{s(void 0),u(!1),i(!1)},[]);return{ready:n,shouldAnimate:f,fadeIn:l,setReady:d,reset:r}}const ye=t.forwardRef(({isOpen:e,onCancel:n,focusOnOpen:s=!0,maxWidth:f,padding:u,border:l,borderRadius:i,backdropColor:d,backdropBlur:r,portalTarget:v,className:T,style:_,children:N,...D},p)=>{const g=t.useRef(null);t.useImperativeHandle(p,()=>g.current,[]);const[j,x]=t.useState(!1);t.useEffect(()=>{x(!0)},[]);const I=t.useMemo(()=>({...{...f!=null?{"--dialog-max-width":f}:{},...u!=null?{"--dialog-padding":u}:{},...l!=null?{"--dialog-border":l}:{},...i!=null?{"--dialog-border-radius":i}:{},...d!=null?{"--dialog-backdrop-color":d}:{},...r!=null?{"--dialog-backdrop-blur":r}:{}},..._??{}}),[f,u,l,i,d,r,_]);t.useEffect(()=>{const o=g.current;if(o&&e!==void 0)try{e?(o.open||o.showModal(),s&&o.focus()):o.open&&o.close()}catch{}},[e,s]);const w=o=>{if(o.preventDefault(),n){n();return}e===void 0&&g.current?.close()},F=c.jsx("dialog",{ref:g,className:V("dialog",T),style:I,onCancel:w,...D,children:N});if(!j)return null;const m=v??(typeof document<"u"?document.body:null);return m?le.createPortal(F,m):null}),Ee=(e,n)=>{const s=n-1,f=n-2;return n<=1?"100%":e===s?"70%":e===f?"85%":"100%"},he=({rows:e=0})=>e<=0?c.jsx("div",{className:"skeleton skeleton__block","aria-busy":"true"}):c.jsx("div",{className:"skeleton skeleton__rows","aria-busy":"true",children:Array.from({length:e}).map((n,s)=>c.jsx("div",{className:"skeleton__row",style:{width:Ee(s,e)}},s))}),Ae=O.defaultWidth,Re=O.defaultAspectRatio,K=O.defaultObjectFit,U=e=>e!=null&&e!=="",Q=e=>e==="auto"?void 0:e,pe=e=>e==="auto"||e===""?void 0:e;function je({src:e,disableBlob:n=!1,disableLazyLoading:s=!1,disableAssetHash:f=!1,objectFit:u,aspectRatio:l,clickOpenMode:i="none",style:d,className:r,onLoad:v,onError:T,fetchPriority:_="auto",loading:N="eager",decoding:D="async",width:p,height:g,onClick:j,alt:x,...I},w){const F=re(),{src:m}=ve(e,n,f,_),{ready:o,setReady:z,reset:E}=Se(),[h,S]=t.useState(!1),[A,R]=t.useState("none"),{boxStyle:X,imgStyle:Y}=t.useMemo(()=>{const a=Q(p),M=Q(g),G=pe(l),H=U(a),C=U(M),q=U(G),B=!q&&!C,ee=H&&C?void 0:q?G:B?Re:void 0,te=H?a:Ae,se=C?M:void 0,ae=B&&u==null?K:u??K;return{boxStyle:{width:te,height:se,aspectRatio:ee},imgStyle:{objectFit:ae}}},[l,u,p,g]),k=t.useCallback(a=>{z(a)},[z]);t.useEffect(()=>()=>{S(!1)},[]),t.useEffect(()=>{!m&&h&&S(!1)},[m,h]),t.useEffect(()=>{o===!1&&!s&&h&&S(!1)},[o,s,h]),t.useEffect(()=>{s||(e?(E(),R("none"),k(!1)):(E(),R("none")))},[e,E,k,s]),t.useEffect(()=>{if(!s){if(o===!1)R("fade");else if(o===!0&&A==="fade"){const a=requestAnimationFrame(()=>{R("fade-in")});return()=>{cancelAnimationFrame(a)}}}},[o,A,s]),t.useEffect(()=>{s&&(E(),R("none"))},[s,E]),t.useEffect(()=>{r&&J()},[r]),t.useEffect(()=>{d&&J()},[d]);const y=o===!1&&!s,W=i==="tab"&&!!m&&!y,b=i==="dialog"&&!!m&&!y,Z=(!!j||W||b)&&!y,P=s?{}:{"lazy-image__fade":A==="fade"||A==="fade-in","lazy-image__fade-in":A==="fade-in"},L=y?{}:{"lazy-image__clickable":Z};return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:V("lazy-image",P,L),style:X,children:[y&&c.jsx(ce,{children:c.jsx("div",{className:"lazy-image__skeleton",children:c.jsx(he,{})})}),m&&c.jsx("img",{...I,ref:w,src:m,alt:x,className:"lazy-image__image",draggable:!1,style:Y,onClick:a=>{if(y){a.preventDefault();return}if(j?.(a),!a.defaultPrevented){if(W){F(m);return}b&&S(!0)}},onLoad:a=>{k(!0),v?.(a)},onError:a=>{k(!0),T?.(a)},loading:N,decoding:D,..._?{fetchpriority:_}:{}})]}),m&&c.jsx(ye,{isOpen:h,className:"lazy-image__dialog",onCancel:()=>S(!1),onClick:a=>{a.target===a.currentTarget&&S(!1)},children:c.jsx("div",{className:"lazy-image__dialog-content",children:c.jsx("img",{src:m,alt:x,className:"lazy-image__dialog-image",draggable:!1,onClick:a=>{a.stopPropagation()}})})})]})}const Te=t.forwardRef(je);export{Te as L,he as S,Se as u};
