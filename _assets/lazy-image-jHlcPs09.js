import{b as T,k as p,j as o,a4 as w}from"./index-dzPrKldK.js";import{a,i as C,a8 as g,a9 as F,v as B,d as D}from"./preload-sdnFI26d.js";function G(e,s,r,f){const[i,n]=a.useState({src:void 0,loading:!!e&&!s});return a.useEffect(()=>{if(!e||!C()){n({src:void 0,loading:!1});return}if(s){const t=g(e,r);n({src:t,loading:!1});return}const c=F(e);if(c){n({src:c,loading:!1});return}let u=!1;return n({src:void 0,loading:!0}),B(e,f).then(t=>{u||n({src:t,loading:!1})}).catch(()=>{if(!u){const t=g(e,r);n({src:t,loading:!1})}}),()=>{u=!0}},[e,s,r,f]),i}const O=p.loaderTimeout;function U(){const{withTimeout:e}=T(),[s,r]=a.useState(void 0),[f,i]=a.useState(!1),[n,c]=a.useState(!1),u=a.useCallback(_=>{e(()=>{r(_)},_?0:O)},[e]);a.useEffect(()=>{s===!1?i(!0):s===!0&&c(!0)},[s]);const t=a.useCallback(()=>{r(void 0),i(!1),c(!1)},[]);return{ready:s,shouldAnimate:f,fadeIn:n,setReady:u,reset:t}}const W=(e,s)=>{const r=s-1,f=s-2;return s<=1?"100%":e===r?"70%":e===f?"85%":"100%"},q=({rows:e=0})=>e<=0?o.jsx("div",{className:"skeleton skeleton__block","aria-busy":"true"}):o.jsx("div",{className:"skeleton skeleton__rows","aria-busy":"true",children:Array.from({length:e}).map((s,r)=>o.jsx("div",{className:"skeleton__row",style:{width:W(r,e)}},r))});function M({src:e,style:s,className:r,onLoad:f,onError:i,fetchPriority:n="high",loading:c="eager",decoding:u="async",disableLazyLoading:t=!1,disableBlob:_=!1,disableAssetHash:j=!1,objectFit:R="cover",aspectRatio:y="auto",...N},h){const{src:x}=G(e,_,j,n),{ready:S,setReady:E,reset:d}=U(),[m,v]=a.useState("none"),k=a.useCallback(l=>{E(l)},[E]);a.useEffect(()=>{t||(e?(d(),v("none"),k(!1)):(d(),v("none")))},[e,d,k,t]),a.useEffect(()=>{if(!t){if(S===!1)v("fade");else if(S===!0&&m==="fade"){const l=requestAnimationFrame(()=>{v("fade-in")});return()=>{cancelAnimationFrame(l)}}}},[S,m,t]),a.useEffect(()=>{t&&(d(),v("none"))},[t,d]);const I=S===!1&&!t,A=t?{}:{"lazy-image__fade":m==="fade"||m==="fade-in","lazy-image__fade-in":m==="fade-in"};return o.jsxs("div",{className:D("lazy-image",r,A),style:s,children:[I&&o.jsx(w,{children:o.jsx("div",{className:"lazy-image__skeleton",style:{aspectRatio:y},children:o.jsx(q,{})})}),x&&o.jsx("img",{...N,ref:h,src:x,className:"lazy-image__image",style:{...s||{},objectFit:R,aspectRatio:y},onLoad:l=>{k(!0),f?.(l)},onError:l=>{k(!0),i?.(l)},loading:c,decoding:u,...n?{fetchpriority:n}:{}})]})}const J=a.forwardRef(M);export{J as L,q as S,U as u};
